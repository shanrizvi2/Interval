{% extends "layout.html" %}

{% block title %}
    Dashboard
{% endblock %}

{% block main %}
        <div class = dash>DASHBOARD</div>

        {% for row in rows %}
        <div class = type>{{ row["activity"] }}</div>
        <div class = dash>Total: {{ row["total"] }}</div>
        <div class = dash>Goal: {{ row["goal"] }}</div>
        <div class = hide>
        {% for i in range (((1-row["number"]) * 7), (((1-row["number"]) * 7)+7)) %}
			<div class = {{ row["activity"] }}> {{ array[i] }}</div>
			<div class = d{{ row["activity"] }}> {{ day[i] }}</div>
        {% endfor %}
        </div>
        <div class = graph>
            <canvas id="{{ row["activity"] }}" width="400" height="400" ></canvas>
        </div>
        {% endfor %}
        <script>

    window.onload = function () {

	var types = document.querySelectorAll('.type').length;
	console.log(types);
	for (var f = 0; f < types; f++)
	{
		var data=[];
		var day =[];
		var type = document.querySelectorAll('.type')[f].innerHTML;
		var num = (document.querySelectorAll(`.${type}`).length);
		for (var i = 0; i < num; i++)
		{
			data.push(document.querySelectorAll(`.${type}`)[i].innerHTML);
			day.push(document.querySelectorAll(`.d${type}`)[i].innerHTML);
			console.log(document.querySelectorAll(`.d${type}`)[i].innerHTML);
		}
		day.forEach(function (part, index, theArray)
		{
			theArray[index] = part.substr(0,11);
		})
		console.log(day);

		//set max y
		max = Math.max(...data);
		while (max % 5 != 0)
		{
			max++;
		}
		Chart.defaults.global.legend.display = false;
		const CHART = document.getElementById(`${type}`);
		var myBarChart = new Chart(CHART, {
	    type: 'line',
	            data: {
	                labels: day,
	                datasets: [{
	                        label: "My First dataset",
	                        data: data,
	                        fill: false,
	                        backgroundColor: "#CD1919 ",
	                        borderColor: "#CD1919",
	                        borderCapStyle: 'butt',
	                        borderDash: [5, 5],
	                    }]
	            },
	            options: {
	                responsive: true,
	                legend: {
	                    position: 'bottom',
	                },
	                hover: {
	                    mode: 'label'
	                },
	                scales: {
	                    xAxes: [{
	                            display: true,
	                            scaleLabel: {
	                                display: true,
	                                labelString: 'Day'
	                            }
	                        }],
	                    yAxes: [{
	                            display: true,
	                            scaleLabel: {
	                                display: true,
	                                labelString: 'Hours'
	                            },
	                            ticks: {
	                                beginAtZero: true,
	                                max: max
	                            }
	                        }]
	                },
	                title: {
	                    display: false,
	                    text: `${type}`
	                }
	            }

	});
	}
}


        </script>
{% endblock %}


